name: SingleFile Web Capture

on:
  workflow_dispatch:
  push:
    branches:
      - main
    paths:
      - 'rnd--browser-plugin-singlefile/cli-tool/single-file-cli/**'

jobs:
  capture-webpage:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3
      
      - name: Build SingleFile Docker image
        working-directory: rnd--browser-plugin-singlefile/cli-tool/single-file-cli
        run: |
          docker build -t singlefile .
      
      - name: Create output directory
        run: mkdir -p output
      
      - name: Capture webpage with SingleFile
        run: |
          docker run --rm \
            -v "$(pwd)/output:/usr/src/app/out" \
            singlefile \
            https://roadmap.sh/ai-engineer
      
      - name: Rename output file
        run: |
          # Find the generated file and rename it
          if [ -f output/*.html ]; then
            mv output/*.html output/roadmap-ai-eng.html
          fi
      
      - name: Upload captured webpage as artifact
        uses: actions/upload-artifact@v4
        with:
          name: captured-webpage
          path: output/roadmap-ai-eng.html
          retention-days: 30
