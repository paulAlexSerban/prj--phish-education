name: SingleFile Web Capture

on:
  workflow_dispatch:
    inputs:
      url:
        description: 'Webpage URL to capture'
        required: true
        default: 'https://example.com'
      output_filename:
        description: 'Output filename (with .html extension)'
        required: false
        default: 'captured-page.html'

jobs:
  capture-webpage:
    runs-on: ubuntu-latest
    steps:
        - name: Print input values
          run: |
            echo "URL to capture: ${{ github.event.inputs.url }}"
            echo "Output filename: ${{ github.event.inputs.output_filename }}"
        - name: Checkout repository
          uses: actions/checkout@v4
            
        - name: Set up Docker Buildx
          uses: docker/setup-buildx-action@v3
        
        - name: Build SingleFile Docker image
          working-directory: .
          run: |
            docker build -t singlefile -f ./single-file-cli.Dockerfile .
            
        - name: Create output directory
          run: mkdir -p output
        
        - name: Capture webpage with SingleFile
          run: |
            docker run -v "${{ github.workspace }}/output:/output" singlefile "${{ github.event.inputs.url }}" > "/output/${{ github.event.inputs.output_filename }}"

        - name: Upload captured webpage as artifact
          uses: actions/upload-artifact@v6
          with:
              name: captured-webpage
              path: output/${{ github.event.inputs.output_filename }}
              retention-days: 30